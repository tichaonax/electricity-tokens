# Prisma Commands: Safe vs Dangerous

## ‚ö†Ô∏è CRITICAL: Commands That Modify Schema Files

**NEVER use these commands during normal operation!** They will modify your `prisma/schema.prisma` file and cause Git conflicts:

### üö´ Dangerous Commands (Modify Schema)

```bash
# These commands modify prisma/schema.prisma:
npx prisma db pull          # Introspects DB and rewrites schema
npx prisma db push          # Syncs schema to DB (for prototyping only)
npx prisma introspect       # Old name for db pull
npx prisma format           # Formats schema (safe, but triggers file changes)
```

**When these commands run:**

- They modify `prisma/schema.prisma`
- Git will show the schema as modified
- `git pull` will cause merge conflicts
- Your carefully crafted schema might be overwritten

**Where they appear in this codebase:**

- ‚ùå `scripts/comprehensive-installer.js` - Uses `db pull` and `db push`
- ‚ùå `scripts/db-setup-auto.js` - Uses `db pull` and `db push`
- ‚ùå `scripts/windows-db-init.js` - Uses `db push`
- ‚ùå `scripts/setup-database.js` - Uses `db push`
- ‚ùå `scripts/init-database.js` - Uses `db push`

**These scripts should only be used during:**

- Initial project setup
- Database initialization
- Development environment setup

## ‚úÖ Safe Commands (Never Modify Schema)

### Safe for Production/Service Use

```bash
# These are safe - they never modify the schema file:
npx prisma generate          # Generates Prisma Client from schema
npx prisma migrate deploy    # Applies migrations (production)
npx prisma migrate dev       # Creates AND applies migrations (development)
npx prisma migrate status    # Checks migration status
npx prisma migrate resolve   # Marks migrations as applied/rolled back
```

**These are used in:**

- ‚úÖ Service wrapper (`service-wrapper-hybrid.js`) - Uses `migrate deploy` and `generate`
- ‚úÖ Migration scripts - Use `migrate dev` for creating new migrations

## Correct Workflow

### Development (Making Schema Changes)

1. **Edit schema manually:**

   ```bash
   # Edit prisma/schema.prisma in your editor
   ```

2. **Create migration:**

   ```bash
   npx prisma migrate dev --name descriptive_name
   # This creates migration files and applies them
   ```

3. **Commit to Git:**
   ```bash
   git add prisma/schema.prisma
   git add prisma/migrations/
   git commit -m "feat: Add new field to schema"
   git push
   ```

### Production/Remote Server (Applying Changes)

1. **Pull changes:**

   ```bash
   git pull
   ```

2. **Service automatically runs:**
   ```bash
   npx prisma migrate deploy  # Applies migrations
   npx prisma generate        # Regenerates client
   ```

## What Gets Generated vs What's Source Code

### Tracked in Git (Source Code)

- ‚úÖ `prisma/schema.prisma` - Your database schema definition
- ‚úÖ `prisma/migrations/` - All migration files
- ‚úÖ Never gets "regenerated" by Prisma

### NOT Tracked (Generated Code)

- ‚ùå `node_modules/@prisma/client/` - Generated Prisma Client
- ‚ùå `.next/` - Next.js build output
- ‚ùå Regenerated by `npx prisma generate`

## Why This Matters

When you use `prisma db pull` or `prisma db push`:

1. Prisma introspects your database structure
2. It **rewrites** your `prisma/schema.prisma` file
3. You lose:
   - Comments
   - Custom formatting
   - Specific ordering
   - Documentation
4. Git shows the schema as modified
5. Next `git pull` causes conflicts

## Summary

**Simple rule:** If you didn't manually edit `prisma/schema.prisma`, and Git shows it as modified, something ran a dangerous command!

**For services:** Only use `migrate deploy` and `generate` - never `db pull` or `db push`.

**For development:** Use `migrate dev` to create migrations, never `db push`.
